#!/usr/bin/env ruby

require "bundler/setup"
require "edr_treadmill"
require "thor"
require "active_support/core_ext/class/subclasses"

module EdrTreadmill
  class CLI < Thor
    def self.define_activity(activity_class)
      name = activity_class.name.demodulize.underscore.sub(/_activity$/, "")

      desc "edr_treadmill #{name}", "Description of activity"
      define_method(name) do
        puts "Did a thing"
      end
    end
  end
end

class ActivitiesMetadata
  def classes
    EdrTreadmill::Activities::BaseActivity.subclasses
  end

  def activity_names
    classes.map(&:activity_name)
  end
end

ActivitiesMetadata.new.classes.each do |activity_class|
  EdrTreadmill::CLI.define_activity(activity_class)
end

EdrTreadmill::CLI.start
